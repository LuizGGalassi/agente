# Nome do fluxo de trabalho
name: Agente de Conteudo (Rodar agente_v1.py)

on:
  # 1. Permite que voc√™ rode manualmente pela aba "Actions"
  workflow_dispatch:
  
  # 2. O Agendador "Set-and-Forget" (Cron Job)
  schedule:
    # Roda todo dia √†s 08:00 UTC (05:00 da manh√£ no Brasil)
    # Voc√™ pode ajustar o hor√°rio. Use https://crontab.guru para
    # gerar um novo.
    - cron: '0 8 * * *'

jobs:
  build-and-run-agent:
    runs-on: ubuntu-latest # Roda em um servidor Linux padr√£o
    permissions:
      contents: write
    steps:
      # 1. Baixa o seu c√≥digo (agente_v1.py, requirements.txt)
      - name: 1. Checkout do Reposit√≥rio
        uses: actions/checkout@v4

      # 2. Configura o ambiente Python
      - name: 2. Configurar Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. Instala as "compras" (bibliotecas)
      - name: 3. Instalar Depend√™ncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. Executa o Agente!
      - name: 4. Rodar o Agente de IA
        env:
          # Esta √© a m√°gica: Injeta o "segredo" no ambiente
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        run: |
          python agente_v1.py

      # 5. Publica o novo arquivo .md
      # Esta a√ß√£o automaticamente faz um "commit" dos novos arquivos
      # que o script (agente_v1.py) criou na pasta _posts
      - name: 5. Fazer Commit do novo post
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üì∞ Novo post (bot)"
          file_pattern: "_posts/*.md _data/*.log"
